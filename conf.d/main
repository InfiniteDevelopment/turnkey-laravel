#!/bin/sh -ex

NAME=laravel
DB_PASS=$(mcookie)

WEBROOT=/var/www/laravel
LOCAL_SRC=/usr/local/src

# start mysql server
/etc/init.d/mysql start

# create symfony database and user
mysql --user=root --password=$MYSQL_PASS --batch --execute "\
CREATE DATABASE $NAME; \
GRANT ALL PRIVILEGES ON $NAME.* TO $NAME@localhost IDENTIFIED BY '$DB_PASS'; \
FLUSH PRIVILEGES;"

# install and configure laravel
cd $WEBROOT

# setting permissions for local storage
chmod -R 755 $WEBROOT/app/storage

# install composer dependencies
php composer install

# configure apache
a2dissite default
a2ensite laravel
a2enmod rewrite

# stop mysql
/etc/init.d/mysql stop